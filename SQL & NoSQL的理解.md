*******************************************
**SQL & NoSQL的理解**    2018/11/20
*******************************************
**1. SQL & NoSQL的特征** 
  - SQL（关系型数据库）
    - 使用表存储相关的数据；
    - 在使用表之前需要先定义表的schema；
    - 鼓励使用规范化来减少数据的冗余；
    - 支持使用Join操作，使用一条SQL语句从多张表中取出相关的数据；
    - 需要满足数据完整性约束规则；
    - 使用事务来保证数据的一致性；
    - 能够大规模的使用；
    - 使用强大的SQL语言进行查询操作；
    - 提供大量的支持，专业技能和辅助工具。     
  - NoSQL（非关系型数据库）——SQL的有力补充
    - 使用类Json格式的文档来存储键值对；
    - 存储数据不需要特定的模式；
    - 使用非规范化的标准存储信息，以保证一个文档中包含一个条目的所有信息；
    - 不需要使用Join操作；
    - 允许数据不用通过验证就可以存储到任意的位置；
    - 保证更新的单个文档，而不是多个文档的原子性；
    - 提供卓越的性能和可扩展性；
    - 使用Json数据对象进行查询。


**2. SQL & NoSQL的区别**
  - 语义场景方面
    - **SQL是准确的**。适合需求确定和对数据完整性要求严格的项目，典型的使用场景：在线商店，银行系统
    - **NoSQL是多变的**。适用于对速度和扩展性比较看重的，同时需求不确定，不断发展的场景，典型的使用场景：社交网络，客户管理，网络分析系统。
  - 存储结构方面
    - **SQL适合存储结构化数据**。比如用户的账号、地址等：
       1. 数据通常需要做结构化查询；
       2. 数据的规模、增长的速度通常是可以预期的；
       3. 有保证数据的事务性、一致性的需求。
    - **NoSQL适合存储非结构化数据**。比如微博内容，文章，评论等：
      1. 数据通常用来做模糊处理，如全文搜索，机器学习；
      2. 数据是海量的，而且正常速度是难以预期的；
      3. 根据数据的特定，NoSQL数据库他你刚才具有无限（至少接近）伸缩性；
      4. 按key获取数据效率很高，但对join或其他结构化查询的支持比较差。
  - 典型代表方面
    - SQL ：SQL Server，Oracle, MySQL，PostgreSQL等
    - NoSQL：MongoDB，Redis,Memcached等
 
 
**3. SQL & NoSQL的缺点**
  - SQL 
    - **大数据场景下I/O较高**。因为数据是按行存储，即使只针对某一列进行运算，关系型数据库也会将整行数据从存储设备中读入内容，导致I/O较高；
    - **存储的行记录**，无法存储数据结构；
    - **表结构schema扩展不方便**。如需要修改表结构，需要执行DDL，语句修改期间会导致锁表，部署服务不可用；
    - **存储和处理复杂关系数据功能较弱**。许多应用程序需要了解和导航高度连接数据之间的关系，比如推荐，图谱等。关系型数据库并不擅于处理数据点之间的关系。数据模型和严格的模式使得数据库很难添加新的或不同种类的关联信息。
  
  - NoSQL 
    - **事务库事务功能的缺失**。（ACID），且不同的分类对事务的支持粒度不同。

**4. 常见NoSQL的分类**
  - **列式数据**     
  按列存储数据，最大的特点是方便存储结构化和半结构化数据，方便做数据压缩，对针对某一列或者某几列的查询有非常大的IO优势。
    1. **对应的NoSQL**： HBASE，BigTable等；
    2. **典型应用场景**： 按列存储，针对某一列或某几列的查询有IO优势；
    3. **优点**：查找速度快，可扩展性强，更容易进行分布式扩展；
    4. **缺点**：功能相对局限，不适合扫描小量数据；不适合随机的更新；不适合做含有删除和更新的实时操作；单行数据是ACID的，多行的事务时，不支持师傅的正常回滚，支持隔离和持久性（ID），不能保证原子性和一致性（AC）。    
  
  - **文档数据库**     
  通常采用Json或XML格式将半结构化数据存储为文档。与SQL不同的是，每个NoSQL文档的结构都是不同的，更加灵活地整理和存储。
    1. **对应的NoSQL**：CouchDB，MongoDB；
    2. **典型应用场景**：存储类似Json格式的内容，可对某些字段建立索引功能，是最像关系型的数据库；
    3. **优点**：数据结构要求不严格，表结构可变，不需要像关系型数据库一样需要预先定义表结构；
    4. **缺点**：查询性能不高，而且缺乏统一的查询语法；仅支持单文档原子性，不支持多文档原子性；隔离级别仅支持已提交读，可能导致可重复读、幻读的问题；不支持负责查询，比如join查询。
  
  - **图形数据库**    
  可存储顶点以及称为边缘的直接链路。图形数据库可以在SQL和NoSQL数据库上构建。顶点和边缘可以拥有各自的相关属性。
    1. **对应的NoSQL**：Neo4j, ArangoDB，Titan等；
    2. **典型应用场景**：社交网络，推荐系统等。专注于构建关系图谱，善于处理大量复杂、互连接、低结构化的数据，数据往往变化迅速，且查询频繁。
    3. **优点**：利用图结构相关算法。比如最短路径寻址，N度关系查找等。
    4. **缺点**：需要对整个图计算才可得出需要的信息，而且这种结构不好做分布式集群。
  
  - **内存键值对存储**      
  通过key快速查询到其value。一般来说，存储不管value的格式，照单全收，是针对读取密集型应用程序工作负载（社交网络、游戏、媒体共享。Q&A门户）。内存缓存可将重要数据存储在内存中以实现低延迟访问，从而提高应用程序性能。
    1. **对应的NoSQL**：Redis，Memcached等；
    2. **典型应用场景**：内容缓存，主要用于处理大量数据的高访问负责，也用于一些日志系统；
    3. **优点**：查询速度快；
    4. **缺点**：数据无结构化，通常只被当作字符串或二进制数据；针对ACID，Redis事务不能支持原子性和持久性（AD），只支持隔离性和一致性（IC）。

**5. SQL & NoSQL选型指标**
  - 数据量
  - 并发量
  - 实时性
  - 一致性要求
  - 读写分布和类型
  - 安全性
  - 运维成本
  
  常见软件系统数据库选型参考如下：
  - 内部使用的管理型系统，如运营系统，数据量少，并发量小，首选考虑关系型；
  - 大流量系统，如电商单品页，后台考虑关系型，前台考虑选内存型；
  - 日志型系统，原始数据考虑列式数据库，日志搜索考虑选倒排索引；
  - 搜索型系统，如站内搜索，非通用搜索，商品搜索，后台考虑选关系型，前台考虑选倒排索引；
  - 事务型系统，如库存，交易，记账，考虑选关系型+缓存+一致性型协议
  - 离线计算，如大量数据分析，考虑选列式或者关系型；
  - 实时计算，如实时监控，可以考虑选内存型或者列式数据库
  
  目前很多架构是使用组合方案。具体的还是根据业务需求来进行考量选型。
    
  **Reference**     
  - 一文分辨NoSQL 还是 SQL   https://www.toutiao.com/a6588069948159951373/      
   - 阿里P8架构师谈：NoSQL和SQL的区别，NoSQL的使用场景和选型比较 https://www.toutiao.com/a6594016739183297038/    
   - What is NoSQL?  https://www.mongodb.com/nosql-explained?     
   - Picking the Right NoSQL Database Tool http://www.monitis.com/blog/picking-the-right-nosql-database-tool/      
   - 知乎解答  https://www.zhihu.com/question/20059632    
  
  
